!function(){var e={};global.VEL=global.VEL||{},global.VEL.Skynet=global.VEL.Skynet||{},global.VEL.Skynet.Application=global.VEL.Skynet.Application||{},global.VEL.Skynet.Application.Client=global.VEL.Skynet.Application.Client||{},global.VEL.Skynet.Application.Client.Documents=global.VEL.Skynet.Application.Client.Documents||{},global.VEL.Skynet.Application.Client.GoogleClassroom=global.VEL.Skynet.Application.Client.GoogleClassroom||{},ss.initAssembly(e,"VEL.Skynet.Application.Client");var t=function(){this.$5=0,this.$6=!1,document.addEventListener("mozfullscreenchange",ss.mkdel(this,this.$0)),document.addEventListener("webkitfullscreenchange",ss.mkdel(this,this.$0)),document.addEventListener("fullscreenchange",ss.mkdel(this,this.$0)),document.addEventListener("MSFullscreenChange",ss.mkdel(this,this.$0))};t.__typeName="VEL.Skynet.Application.Client.$0";var s=function(){this.$1$1=null,this.$1$2=null,this.$1$3=0,this.$1$4=0};s.__typeName="VEL.Skynet.Application.Client.$1";var i=function(){if(this.$z=null,this.$q=null,this.$s=null,this.$v=null,this.$A=null,this.$r=0,this.$C=null,this.$B=0,this.$y=0,this.$u=!1,this.$w=null,this.$x=null,this.$p=null,this.$t=null,VEL.Skynet.Core.Application.App.call(this),VEL.Skynet.Global.Modules.app=this,this.$r=ServerModel.fontStackId,this.$s=new t,this.$q=new o(this),this.$z=new r,this.$v=new VEL.Skynet.Global.Controls.Control.$ctor1(".js-play-preload"),this.$A=VEL.Skynet.Global.Helpers.SettingsHelper.get$2("session_id",null),ss.isNullOrUndefined(this.$A)&&(this.$A=ss.getHashCode(this).toString(),VEL.Skynet.Global.Helpers.SettingsHelper.set("session_id",this.$A,!0)),this.$t=i.$0(),void 0!==ServerModel.templateId){var e=VEL.Skynet.Core.Application.TemplateManager.getTemplate(ServerModel.templateId,!0);ServerModel.templateId=e.get_id(),this.$c(ServerModel.templateId,0)}};i.__typeName="VEL.Skynet.Application.Client.ClientApp",i.$0=function(){return ss.isNullOrEmptyString(ServerModel.googleClassroomCourseWorkID)?null:new a(ServerModel.googleClassroomClientID,ServerModel.googleClassroomApiKey,ServerModel.googleClassroomCourseID,ServerModel.googleClassroomCourseWorkID)},global.VEL.Skynet.Application.Client.ClientApp=i;var n=function(){};n.__typeName="VEL.Skynet.Application.Client.FullscreenSeleniumHook",global.VEL.Skynet.Application.Client.FullscreenSeleniumHook=n;var o=function(e){this.$c=!1,this.$a=20,this.$b=!1,this.$9=null,this.$9=e,this.$0()};o.__typeName="VEL.Skynet.Application.Client.Documents.DocumentStore",global.VEL.Skynet.Application.Client.Documents.DocumentStore=o;var r=function(){};r.__typeName="VEL.Skynet.Application.Client.Documents.ResultsStore",global.VEL.Skynet.Application.Client.Documents.ResultsStore=r;var l=function(e,t,s,i){this.$c=null,this.$b=null,this.$d=null,this.$e=null,this.$a=null,l.$0(e,"googleClassroomClientID","Google Classroom assignment client ID"),this.$c=e,l.$0(t,"googleClassroomApiKey","Google Classroom assignment API key"),this.$b=t,l.$0(s,"googleClassroomCourseID","Google Classroom course ID"),this.$d=s,l.$0(i,"googleClassroomCourseWorkID","Google Classroom course work ID"),this.$e=i};l.__typeName="VEL.Skynet.Application.Client.GoogleClassroom.$0",l.$0=function(e,t,s){if(ss.isNullOrUndefined(e))throw new ss.ArgumentNullException(t,"The "+s+" is null.");if(ss.isNullOrEmptyString(e))throw new ss.ArgumentException("The "+s+" is missing.",t)};var a=function(e,t,s,i){this.$3=null,this.$2=null,this.$4=null,this.$1$1=null,this.$3=new r,this.$2=new l(e,t,s,i)};a.__typeName="VEL.Skynet.Application.Client.GoogleClassroom.GoogleClassroomApplicationAssignment",a.$0=function(e){return!!(4&e)},global.VEL.Skynet.Application.Client.GoogleClassroom.GoogleClassroomApplicationAssignment=a;var u=function(e,t){this.$2=null,this.$1$1=null,this.set_studentSubmission(e),this.$2=t};u.__typeName="VEL.Skynet.Application.Client.GoogleClassroom.GoogleClassroomUserAssignmentData",global.VEL.Skynet.Application.Client.GoogleClassroom.GoogleClassroomUserAssignmentData=u,ss.initClass(t,e,{$3:function(e){if(!/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream||!0===window.navigator.standalone)if(n.forcePseudo)this.$2();else{this.$6=!0;var t=$(".js-activity-wrapper");if(0!==t.length){var s=t.get(0);s.requestFullscreen||s.msRequestFullscreen||s.mozRequestFullScreen||s.webkitRequestFullscreen?s.requestFullscreen?s.requestFullscreen():s.msRequestFullscreen?s.msRequestFullscreen():s.mozRequestFullScreen?s.mozRequestFullScreen():s.webkitRequestFullscreen():this.$2(),$(".js-activity-wrapper").addClass("is-fullscreen"),this.$5=window.setTimeout(ss.mkdel(this,function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||$("#pseudo_full_screen").is(":visible")||!this.$6||this.$2()}),1500)}}else if(e){var i=window.location.href;i+=-1!==i.indexOf("?")?"&":"?",i+="footer=false&nofullscreen",window.open(i,"_blank")}else this.$2()},$4:function(){if(0!==this.$5&&(window.clearTimeout(this.$5),this.$5=0),$(".js-activity-wrapper").removeClass("is-fullscreen"),$(window).trigger("resize"),$("#pseudo_full_screen").is(":visible"))this.$1();else try{document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}catch(e){}},$0:function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||$("#pseudo_full_screen").is(":visible")||($(".js-activity-wrapper").removeClass("is-fullscreen"),$(window).trigger("resize")),this.$6=!1},$2:function(){$("body").css("overflow","hidden"),$("#pseudo_full_screen").addClass("is-visible"),$("#pseudo_full_screen").append($(".js-activity-wrapper")),$(".js-activity-wrapper").addClass("is-fullscreen")},$1:function(){$("body").css("overflow",""),$(".js-activity-block").append($(".js-activity-wrapper")),$("#pseudo_full_screen").removeClass("is-visible")}}),ss.initClass(s,e,{$2:function(){return this.$1$1},$3:function(e){this.$1$1=e},$0:function(){return this.$1$2},$1:function(e){this.$1$2=e},$6:function(){return this.$1$3},$7:function(e){this.$1$3=e},$4:function(){return this.$1$4},$5:function(e){this.$1$4=e}}),ss.initClass(i,e,{setHomework:function(e,t,s,i){this.$z.setHomework(e,t,s,i)},setPreloader:function(e){this.$p=e},startScreenshot:function(e,t,s){this.setFontStackId(s,!1),this.startGame(2,0,e,t,null)},startFullScreen:function(){var e=4===this.$B||10===this.$B;this.$s.$3(e)},stopFullScreen:function(){this.$s.$4()},isFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||$("#pseudo_full_screen").is(":visible")},triggerAutoSave:function(){this.$q.triggerAutoSave()},forceAutoSave:function(){this.$q.forceAutoSave()},enableAutoSave:function(e){this.$q.enableAutoSave(e)},setThemeId:function(e,t){this.$7(5),0!==e&&(this.$C.selected=VEL.Skynet.Core.View.Themes.ThemeHelper.getTheme(e),t&&(this.destroyView(),this.$k()))},getThemeSelection:function(){return this.$C},setFontStackId:function(e,t){this.$7(4),this.$r=e,t&&(this.destroyView(),this.$k())},getFontStackId:function(){return this.$r},new$1:function(e,t){var s=this.createDocument(t,e);return s.hasEditor()?s:(this.$q.save(0,0,ServerModel.userId,ServerModel.localeId,function(e,t){var s="/resource?guid="+t+"&format=1";window.location.href=s},null,0,null,null),null)},restore:function(e){var t=this.$q.restore(e);return this.set_document(t),t},open:function(e,t,s,i){this.$q.open(e,t,s,null,this.$B,ss.mkdel(this,function(e){this.$c(e.get_template().get_id(),0),this.set_document(e),i(e)}))},startGame:function(e,t,s,i,n){this.$7(6),this.stopGame(),this.$B=e;var o=n;ss.isNullOrUndefined(o)&&(o=ServerModel.templateId),this.$c(o,i),4!==this.$B?this.$q.open(s,!0,t,n,this.$B,ss.mkdel(this,function(e){this.$f(e,n)})):this.$9(s,t,n)},startTestGame:function(e,t,s){this.stopGame(),this.$B=5,this.$c(ServerModel.templateId,e),this.$q.openTest(t,s,this.$B,ss.mkdel(this,function(e){this.$f(e,ServerModel.testConvertToTemplateId)}))},onStartComplete:function(){if(!VEL.Skynet.Global.Helpers.DeviceHelper.isPhoneSized()||1!==this.$B&&9!==this.$B||this.onToggleFullscreen(!0),!this.$8()){var e=ss.isValue(this.get_document())&&this.get_document().get_template().get_id()!==ServerModel.templateId&&!i.$1;e&&(i.$1=!0);console.log("Backend indisponível. Ignorando trackplay.")}},save:function(e,t,s,i,n,o,r){this.$q.save(e,t,ServerModel.userId,ServerModel.localeId,s,i,n,o,r)},saveOptions:function(e,t){this.$q.saveOptions(e,t)},onHomeworkSubmission:function(e,t,s){this.$l(null),this.$z.onHomeworkSubmission(e,ss.mkdel(this,function(e){this.$i(e,t,s)}),s)},$i:function(e,t,s){this.$l(e),this.get_isGoogleClassroomAssignment()&&!this.get_activeGame().get_isRestartEnabled()?this.$n(t,s):t()},$l:function(e){this.get_isGoogleClassroomAssignment()&&this.$t.set_homeworkSubmission(e)},onToggleFullscreen:function(e){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement||$("#pseudo_full_screen").is(":visible");if(e===t)return t;if(ss.isNullOrUndefined(e)&&(e=!t),ss.unbox(e)){var s=4===this.$B||10===this.$B;this.$s.$3(s)}else this.$s.$4();return!t},onRestartGame:function(){9===this.$B||10===this.$B?this.onExitAssignment():this.restart()},onCheckLeaderboard:function(e,t,s,i){var n={};n.score=t,n.time=s,n.activityId=ServerModel.activityId,n.templateId=e,$.ajax({type:"GET",url:"/leaderboardajax/getentryrank",data:n,success:function(e,t,s){i(parseInt(e.toString()))},error:function(e,t,s){i(-1)}})},onAddLeaderboard:function(e,t,s,i,n,o,r){var l={};l.score=t,l.time=s,l.name=e,l.mode=i,l.activityId=ServerModel.activityId,l.templateId=n,$.ajax({type:"POST",url:"/leaderboardajax/addentry",data:l,success:function(e,t,s){o(parseInt(e.toString()))},error:function(e,t,s){r()}})},onSetTestCard:function(e){ss.isNullOrUndefined(e)||(this.setSetting("tc_page",e.page.toString(),!0),this.setSetting("tc_section",e.section.toString(),!0))},onGetTestCard:function(){var e=new VEL.Skynet.Core.Application.TestCardSetting;return e.section=parseInt(this.getSetting("tc_section","0")),e.page=parseInt(this.getSetting("tc_page","0")),e},onSetAudioSetting:function(e,t){var s=ss.Enum.getName(VEL.Skynet.Global.Enums.AudioSetting,e).toLowerCase();this.setSetting(s,t.toString(),!1)},onGetAudioSetting:function(e){var t=ss.Enum.getName(VEL.Skynet.Global.Enums.AudioSetting,e).toLowerCase(),s=this.getSetting(t,"");if(""===s){if(""===(s=this.getSetting("mute",""))){var i;if(0===e)switch(VEL.Skynet.Global.Server.Switches.getInteger(VEL.Skynet.Global.Server.Switches.static$1,VEL.Skynet.Global.Server.SwitchKeys.musicDefaultMuteSetting)){case 1:i=!1;break;case 2:i=1!==this.get_document().get_template().get_themeRequirements().musicType;break;default:i=!0}else i=!1;return i}}return/^\s*true\s*$/i.test(s)},onGetLeaderboardEntries:function(e,t,s,i){var n,o={};t?(n="/resultajax/getleaderboardentries",o.homeworkGameId=ServerModel.homeworkGameId):(n="/leaderboardajax/getentries",o.activityId=ServerModel.activityId,o.templateId=e),$.ajax({type:"GET",url:n,data:o,success:ss.mkdel(this,function(e,t,i){var n=Enumerable.from(VEL.Skynet.Core.Toolbox.Serialization.JsonHelper.deserializeEnumerable(VEL.Skynet.Global.Json.LeaderboardEntryJson).call(null,ss.cast(e,String))).toArray();s(n),ss.isValue(VEL.Skynet.Global.Modules.activityPage)&&VEL.Skynet.Global.Modules.activityPage.updateLeaderboard(n,this.get_document().get_template().get_leaderboardMode())}),error:function(e,t,s){i()}})},onExitAssignment:function(){ss.isValue(VEL.Skynet.Global.Modules.playPage)&&VEL.Skynet.Global.Modules.playPage.restart()},setSetting:function(e,t,s){VEL.Skynet.Global.Helpers.SettingsHelper.set(e,t,s)},getSetting:function(e,t){return VEL.Skynet.Global.Helpers.SettingsHelper.get$2(e,t)},onActivityContentChanged:function(){ss.isValue(VEL.Skynet.Global.Modules.activityPage)&&VEL.Skynet.Global.Modules.activityPage.onContentChanged()},restart:function(){ss.isNullOrUndefined(this.get_activeGame())||(this.$a(),this.$m(null))},onViewBuilt:function(){this.$u=!0},onViewReady:function(){ss.isValue(this.$w)&&ss.isValue(this.$x)&&(this.$w+=", viewReady:"+this.$x.milliseconds()),this.$v.set_isVisible(!1)},destroyView:function(){window.onbeforeunload=null,VEL.Skynet.Core.Application.App.prototype.destroyView.call(this)},$9:function(e,t,s){var i=s;ss.isNullOrUndefined(i)&&(i=ServerModel.templateId);var n=i,o=VEL.Skynet.Core.Application.TemplateManager.createTemplate(n),r=new VEL.Skynet.View.ClientView(this,!1),l=ss.mkdel(this,function(){r.dispose(),this.$v.set_isVisible(!0),this.set_activeGame(null),this.$q.open(e,!0,t,s,this.$B,ss.mkdel(this,function(e){this.$f(e,s)}))}),a=ss.mkdel(this,function(){this.$v.set_isVisible(!1)});this.set_activeGame(new VEL.Skynet.Core.Games.PreStartGame(r,this,l)),r.onPreStart(ServerModel.activityTitle,o.get_title(),o.get_description(),a)},$8:function(){return ServerModel.activityId<0||ss.isNullOrUndefined(this.get_activeGame())||this.get_activeGame().get_isHomeworkClient()||2===this.$B},$f:function(e,t){(this.$7(8),this.set_document(e),this.get_document().set_title(ServerModel.activityTitle),1===this.$B)&&(this.get_document().get_template().getValidity().get_hasErrors()&&$.get("/resourceajax/seterror?activityId="+ServerModel.activityId));ss.isValue(t)&&0!==t&&t!==this.get_document().get_template().get_id()&&this.convertDocument(ss.unbox(t)),this.get_document().setInteractive(),1===this.$B&&VEL.Skynet.Global.Modules.activityPage.onDocumentOpen(),this.setThemeId(this.$C.selected.id,!0),1===this.$B&&(this.$7(9),VEL.Skynet.Global.Modules.activityPage.populateOptionsSection(),VEL.Skynet.Global.Modules.activityPage.populateThemesList(),VEL.Skynet.Global.Modules.activityPage.populateTemplates(),VEL.Skynet.Global.Modules.activityPage.populateLeaderboard(),this.$7(10))},$k:function(){this.$7(11),this.$u=!1,this.$x=new ss.Stopwatch,this.$x.start(),this.$w="",0!==this.$y&&(window.clearTimeout(this.$y),this.$y=0),this.$v.set_isVisible(!0);var e=ss.cast(this.get_document().get_selectedGame(),VEL.Skynet.Core.Application.IGame_Application),t=2!==this.$B,s=this.get_document().get_template().get_contentModel().getUnicodeRange()|VEL.Skynet.Core.DataStructures.UnicodeRange.getUnicodeRange(ServerModel.languageId),i=VEL.Skynet.Global.Server.Switches.getThemeAudio(VEL.Skynet.Global.Server.Switches.static$1,this.$C.selected.id);VEL.Skynet.View.Assets.AssetLoader.start(this.$C.selected,this.$r,s,e.get_template(),t,!0,ss.mkdel(this,this.$g),ss.mkdel(this,this.$e),this.onGetAudioSetting(0),i),this.$y=window.setTimeout(ss.mkdel(this,function(){if(this.$d(),!this.$u){var e=VEL.Skynet.View.Assets.AssetLoader.getPreloadStatus()+"|"+VEL.Skynet.View.Assets.Reusables.ReusableTest.getMemory()+"kB|"+this.$w;VEL.Skynet.Global.LogHelper.event("theme_timeout",e),VEL.Skynet.Global.Shell.writeError(e)}}),3e4)},$d:function(){var e=VEL.Skynet.View.Assets.AssetLoader.getErrors();ss.isValue(e)&&Enumerable.from(e).any()&&VEL.Skynet.Global.LogHelper.event("asset_error",e.join("|"))},$e:function(e,t){ss.isValue(VEL.Skynet.Global.Modules.activityPage)&&VEL.Skynet.Global.Modules.activityPage.onAssetLoaded(e,t),ss.isValue(VEL.Skynet.Global.Modules.playPage)&&VEL.Skynet.Global.Modules.playPage.onAssetLoaded(e,t)},$g:function(){if(this.$d(),this.$w+=", gamePreload:"+this.$x.milliseconds(),this.get_document().get_canPreBuild()){var e="/resourceajax/getprebuild?guid="+ServerModel.activityGuid+"&templateId="+this.get_document().get_template().get_id();$.get(e,ss.mkdel(this,function(e){this.get_document().setPrebuild(ss.cast(e,String)),this.$j()}))}else this.$j()},$j:function(){this.$w+=", prebuildReady:"+this.$x.milliseconds(),this.$a(),2===this.$B?this.$m(ss.mkdel(this,function(){this.$v.set_isVisible(!1)})):this.$m(ss.mkdel(this,this.$h))},$h:function(){this.$w+=", gameStarted:"+this.$x.milliseconds()},$m:function(e){if(!ss.isNullOrUndefined(this.get_document())&&!ss.isNullOrUndefined(this.get_document().get_selectedGame())){this.stopGame(),this.createGame(),ss.isValue(this.view)&&(this.get_activeGame().set_view$1(this.view),this.view.set_game(this.get_activeGame())),this.get_activeGame().registerClient(this.client.guid,this.client.forename,this.client.surname),this.get_activeGame().onGameOverChanged(this.gameOverOptions);var t=this.get_document().get_title();ss.isNullOrUndefined(t)&&(t=ServerModel.activityTitle);var s=t;this.get_activeGame().onBuildAndStart(s,this.get_document().get_seed(),this.$B),this.get_document().set_preBuild(this.get_activeGame().get_prebuild()),ss.staticEquals(e,null)||e()}},$a:function(){this.destroyView(),this.view=new VEL.Skynet.View.ClientView(this,2===this.$B)},$c:function(e,t){if(this.$C=new VEL.Skynet.Core.View.Themes.ThemeSelection,5===this.$B&&0!==t)return this.$C.selected=VEL.Skynet.Core.View.Themes.ThemeHelper.getTheme(t),void(this.$C.available=[this.$C.selected]);for(var s=Enumerable.from(VEL.Skynet.Core.View.Themes.ThemeHelper.getAvailableThemeIds(e)).select(VEL.Skynet.Core.View.Themes.ThemeHelper.getTheme).toArray(),i=Array.prototype.slice.call(s),n=0;n<i.length;n++){var o=i[n],r=VEL.Skynet.Global.Server.Switches.getThemeAction(VEL.Skynet.Global.Server.Switches.static$1,o.id,e);switch(0===r&&(r=VEL.Skynet.Global.Server.Switches.getThemeAction(VEL.Skynet.Global.Server.Switches.static$1,o.id,0)),r){case 1:o.isHidden=!0;break;case 2:case 4:case 5:case 3:o.isHidden=!1;break;case 6:if(o.isHidden){var l=this.$b(o,s);if(ss.isValue(l)){l.isHidden=!0,o.isHidden=!1;var a=ss.indexOf(s,o),u=ss.indexOf(s,l);s[a]=l,s[u]=o,l.id===t&&(t=o.id)}}}if(o.id===t&&o.isHidden){var c=this.$b(o,s);ss.isValue(c)&&!c.isHidden?t=c.id:o.isHidden=!1}}Enumerable.from(s).all(function(e){return e.isHidden})&&((Enumerable.from(s).firstOrDefault(function(e){return e.id===t},ss.getDefaultValue(VEL.Skynet.Core.View.Themes.Theme))||Enumerable.from(s).first()).isHidden=!1);for(var d=Enumerable.from(s).where(function(e){return e.isHidden}).toArray(),h=0;h<d.length;h++){var m=d[h];ss.remove(s,m)}for(var g=Array.prototype.slice.call(s),$=0;$<g.length;$++){var p=g[$],f=VEL.Skynet.Global.Server.Switches.getThemeAction(VEL.Skynet.Global.Server.Switches.static$1,p.id,e);switch(0===f&&(f=VEL.Skynet.Global.Server.Switches.getThemeAction(VEL.Skynet.Global.Server.Switches.static$1,p.id,0)),f){case 3:ss.remove(s,p),ss.insert(s,0,p);break;case 5:ss.remove(s,p),s.push(p);break;case 4:ss.referenceEquals(p,Enumerable.from(s).first())||(ss.remove(s,p),ss.insert(s,1,p))}}this.$C.available=Array.prototype.slice.call(s);var S=0!==t?Enumerable.from(s).singleOrDefault(function(e){return e.id===t},ss.getDefaultValue(VEL.Skynet.Core.View.Themes.Theme)):null;ss.isValue(S)?this.$C.selected=S:this.$C.selected=Enumerable.from(s).first()},$b:function(e,t){return Enumerable.from(t).firstOrDefault(function(t){return!(e.baseId!==t.id&&t.baseId!==t.id||ss.referenceEquals(e,t)||t.isHidden)},ss.getDefaultValue(VEL.Skynet.Core.View.Themes.Theme))},$7:function(e){ss.isValue(this.$p)&&this.$p.info(e)},get_googleClassroom:function(){return this.$o(),this.$t},get_googleClassroomAssignment:function(){return this.$o(),this.$t},get_isGoogleClassroomAssignment:function(){return ss.isValue(this.$t)},$o:function(){if(!this.get_isGoogleClassroomAssignment())throw new ss.InvalidOperationException("This activity is not a Google Classroom assignment.")},$n:function(e,t){this.$t.turnInStudentSubmission().continueWith(function(s){s.isCompleted()?e():t()})}},VEL.Skynet.Core.Application.App,[VEL.Skynet.Core.Application.IApplication,VEL.Skynet.Core.Application.IApplication_Game,VEL.Skynet.Core.Toolbox.Threading.IThreadScope]),ss.initClass(n,e,{}),ss.initClass(o,e,{open:function(e,t,s,i,n,o){"00000000000000000000000000000000"===e||void 0!==ServerModel.userId&&void 0!==ServerModel.activityId||(t=!1);var r=ss.mkdel(this,function(e){this.$6(e,t,s,i,n,function(){o(e)})});this.$1(e,r)},openTest:function(e,t,s,i){var n=(new ss.Random).nextMinMax(0,1e5);window.localStorage["test.doc"]=e,window.localStorage["test.config"]=t,this.open("00000000000000000000000000000000",!0,n,ServerModel.testConvertToTemplateId,s,i)},restore:function(e){if(ss.referenceEquals(window.localStorage["autosave.guid"],e)){var t=window.localStorage["autosave.doc"],s=VEL.Skynet.Global.Helpers.Base64Helper.base64ToDataView(t),i=VEL.Skynet.Core.Application.DocumentFactory.create(s);return i.set_guid(e),i}return null},save:function(e,t,s,i,n,o,r,l,a){this.$c=!0,ss.isNullOrEmptyString(a)||this.$9.get_document().set_title(a),s>0&&this.$9.get_document().set_userId(s),i>0&&this.$9.get_document().set_localeId(i),e>0&&(ServerModel.activityGuid=this.$9.get_document().changeGuid()),this.$8(e,t,function(e,t){ServerModel.activityGuid=t,n(e,t)},o,r,l)},saveOptions:function(e,t){var s=this.$9.get_document();if(!ss.isNullOrUndefined(s)){var i=s.writeOptions(!1),n={type:"POST",url:"/resourceajax/setoptions?activityId="+ServerModel.activityId+"&templateId="+s.get_template().get_id()+"&format="+s.get_format()+"&scope="+e,data:i,cache:!1,contentType:"application/xml",success:function(e,s,i){t()},error:function(e,s,i){t()}};$.ajax(n)}},forceAutoSave:function(){this.$9.get_document().set_title(new VEL.Skynet.Global.Controls.Input.$ctor1(".js-activity-title").get_value());var e=this.$9.get_document().save();this.$4(this.$9.get_document(),e)},triggerAutoSave:function(){this.$a=0},enableAutoSave:function(e){e?window.setInterval(ss.mkdel(this,function(){if(!this.$c&&(this.$a++,8===this.$a&&$(".js-auto-saving").fadeIn(),10===this.$a&&ss.isValue(this.$9.get_document()))){if(this.$b)return void this.$a--;this.$7()}}),200):this.$c=!0},$6:function(e,t,s,i,n,o){e.set_seed(s),ss.isValue(i)&&e.get_template().get_id()!==i&&e.convert(ss.unbox(i),!1),t?this.$3(e,i,n,o):this.$5(e,o)},$5:function(e,t){ss.isNullOrEmptyString(ServerModel.activityGuid)||e.set_guid(ServerModel.activityGuid),t()},$1:function(e,t){if("00000000000000000000000000000000"!==e){var s="https://skynetsites.github.io/perguntas-torta-na-cara/documents/"+e;this.$2(s,function(s){s.set_guid(e),t(s)},function(){})}else{var i=window.localStorage["test.doc"],n=VEL.Skynet.Global.Helpers.Base64Helper.base64ToDataView(i),o=VEL.Skynet.Core.Application.DocumentFactory.create(n);t(o)}},$2:function(e,t,s){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(e){if(200===i.status){var n=ss.cast(i.response,Array);if(ss.isNullOrUndefined(n)||0===n.length)s();else{var o=new DataView(new Uint8Array(n).buffer),r=VEL.Skynet.Core.Application.DocumentFactory.create(o);t(r)}}else s()},i.send()},$8:function(e,t,s,i,n,o){var r=this.$9.get_document().get_guid(),l=this.$9.get_document().save(),a="/createajax/upload?guid="+r+"&activityId="+e+"&userId="+this.$9.get_document().get_userId()+"&aiAssists="+n;ss.isValue(o)&&(a+="&genAIMethod="+ss.unbox(o)),ss.isValue(t)&&(a+="&folderId="+t),a+="&screenshot="+VEL.Skynet.Global.Helpers.SettingsHelper.get("enable_screenshot",!0),a+="&originalActivityId="+(void 0===ServerModel.originalActivityId?0:ServerModel.originalActivityId);for(var u=new Uint8Array(l.byteLength),c=0;c<l.byteLength;c++)u[c]=l.getUint8(c);var d=new XMLHttpRequest;d.open("POST",a,!0),d.onreadystatechange=function(e){if(4===d.readyState)if(200===d.status){var t=JSON.parse(d.responseText);VEL.Skynet.Global.Helpers.AutoSaveHelper.clear(),s(t.ActivityId,t.ActivityGuid)}else ss.staticEquals(i,null)||i()},d.setRequestHeader("Content-Type","application/octet-stream"),d.send(u)},$3:function(e,t,s,i){if("00000000000000000000000000000000"===e.get_guid()){var n=window.localStorage["test.config"];return e.readOptions(n),void i()}var o=t;ss.isNullOrUndefined(o)&&(o=e.get_template().get_id());console.log("Backend indisponível. Usando fallback local para getOptions.");var r='<options><option id="1" value="value1"/><option id="2" value="value2"/></options>';console.log("Fallback XML:",r),e.readOptions(r),i(),console.log("readOptions com fallback concluído.")},$0:function(){try{for(var e=0;e<window.localStorage.length;e++){var t=window.localStorage.key(e);if(ss.startsWithString(t,"doc.value")){window.localStorage.clear();break}}}catch(e){}},$7:function(){this.$b=!0;var e=this.$9.get_document();e.set_title(new VEL.Skynet.Global.Controls.Input.$ctor1(".js-activity-title").get_value()),e.saveAsync(ss.mkdel(this,function(t){this.$4(e,t)}))},$4:function(e,t){if(ss.Int32.div(4*t.byteLength,3)>3145728)this.$b=!1;else{var s=VEL.Skynet.Global.Helpers.Base64Helper.dataViewToBase64(t),i=e.get_guid();window.localStorage["autosave.guid"]=i,window.localStorage["autosave.templateid"]=e.get_template().get_id().toString(),window.localStorage["autosave.doc"]=s,window.localStorage["autosave.user"]=ServerModel.userId.toString(),window.localStorage["autosave.title"]=e.get_title(),window.localStorage["autosave.time"]=VEL.Skynet.Global.Extensions.DateTimeExtensions.toUnix(new Date).toString(),window.setTimeout(function(){$(".js-auto-saving").fadeOut(250)},1e3),this.$b=!1}}}),ss.initClass(r,e,{setHomework:function(e,t,s,i){var n={type:"POST",url:"/MyResultsAjax/SetHomework?activityId="+e+"&code="+t,cache:!1,success:function(e,t,i){s()},error:function(e,t,s){i()}};$.ajax(n)},onHomeworkSubmission:function(e,t,s){if(ServerModel.isFull)t(null);else{var i=e.toXml(),n={type:"POST",url:"/MyResultsAjax/AddHomeworkSubmission?homeworkGameId="+ServerModel.homeworkGameId+"&name="+encodeURIComponent(e.get_player().get_fullName())+"&score="+e.get_score()+"&time="+e.get_timing()+"&playerGuid="+e.get_player().guid,data:i,contentType:"text/xml",cache:!1,success:function(e,s,i){$.get("/MyResultsAjax/RefreshHomework?homeworkGameId="+ServerModel.homeworkGameId),t(ss.cast(e,VEL.Skynet.Global.Json.HomeworkSubmissionInfo))},error:function(e,t,i){s()}};$.ajax(n)}},setGoogleClassroomStudentSubmission:function(e,t,s,i){var n="/MyResultsAjax/SetGoogleClassroomStudentSubmission?homeworkSubmissionId="+e+"&googleClassroomCourseId="+encodeURIComponent(t)+"&googleClassroomCourseWorkId="+encodeURIComponent(s)+"&googleClassroomStudentSubmissionId="+encodeURIComponent(i);return $.ajax({type:"POST",url:n})}}),ss.initClass(l,e,{$1:function(){var e,t,s,i,n=0,o=new ss.TaskCompletionSource,r=ss.mkdel(this,function(){try{e:for(;;)switch(n){case 0:return n=-1,e=this.$2(),n=1,void e.continueWith(r);case 1:return n=-1,t=e.getAwaitedResult(),ss.isNullOrUndefined(t)?((s=new VEL.Skynet.Global.Json.GoogleClassroom.UserState).isSignedIn=!1,void o.setResult(s)):(i=t.getCurrentUserState(),n=2,void i.continueWith(r));case 2:return n=-1,void o.setResult(i.getAwaitedResult());default:break e}}catch(e){o.setException(ss.Exception.wrap(e))}});return r(),o.task},$7:function(){var e,t,s,i,n=0,o=new ss.TaskCompletionSource,r=ss.mkdel(this,function(){try{e:for(;;)switch(n){case 0:case 1:case 2:case 3:0===n&&(n=1);try{t:for(;;)switch(n){case 1:return n=-1,e=this.$2(),n=2,void e.continueWith(r);case 2:return n=-1,t=e.getAwaitedResult(),s=t.signIn("do-assignment"),n=3,void s.continueWith(r);case 3:n=-1,s.getAwaitedResult(),n=-1;break t;default:break t}}catch(e){if(e=ss.Exception.wrap(e),!ss.isInstanceOfType(e,ss.PromiseException))throw e;if(i=ss.cast(e,ss.PromiseException),!this.$3(i))throw e}n=-1;break e;default:break e}o.setResult(null)}catch(e){o.setException(ss.Exception.wrap(e))}});return r(),o.task},$0:function(){var e,t,s,i,n=0,o=new ss.TaskCompletionSource,r=ss.mkdel(this,function(){try{e:for(;;)switch(n){case 0:case 1:case 2:case 3:0===n&&(n=1);try{t:for(;;)switch(n){case 1:return n=-1,e=this.$2(),n=2,void e.continueWith(r);case 2:return n=-1,t=e.getAwaitedResult(),s=t.forceSignIn("do-assignment"),n=3,void s.continueWith(r);case 3:n=-1,s.getAwaitedResult(),n=-1;break t;default:break t}}catch(e){if(e=ss.Exception.wrap(e),!ss.isInstanceOfType(e,ss.PromiseException))throw e;if(i=ss.cast(e,ss.PromiseException),!this.$3(i))throw e}n=-1;break e;default:break e}o.setResult(null)}catch(e){o.setException(ss.Exception.wrap(e))}});return r(),o.task},$3:function(e){var t=VEL.Skynet.Global.Helpers.GoogleClassroomHelper.exceptionToError(e);switch(ss.isValue(t)?t.errorCode:null){case"popup_closed":case"access_denied":return!0;default:return!1}},$8:function(){var e,t,s,i=0,n=new ss.TaskCompletionSource,o=ss.mkdel(this,function(){try{e:for(;;)switch(i){case 0:return i=-1,e=this.$2(),i=1,void e.continueWith(o);case 1:return i=-1,t=e.getAwaitedResult(),s=t.signOut(),i=2,void s.continueWith(o);case 2:i=-1,s.getAwaitedResult(),i=-1;break e;default:break e}n.setResult(null)}catch(e){n.setException(ss.Exception.wrap(e))}});return o(),n.task},$4:function(){var e,t,s,i,n,o=0,r=new ss.TaskCompletionSource,l=ss.mkdel(this,function(){try{e:for(;;)switch(o){case 0:return o=-1,e=this.$2(),o=1,void e.continueWith(l);case 1:return o=-1,t=e.getAwaitedResult(),s=this.$6(t),i=this.$5(t),n=ss.Task.whenAll([s,i]),o=2,void n.continueWith(l);case 2:return o=-1,n.getAwaitedResult(),void r.setResult(new u(s.getResult(),i.getResult()));default:break e}}catch(e){r.setException(ss.Exception.wrap(e))}});return l(),r.task},$6:function(e){var t,s=0,i=new ss.TaskCompletionSource,n=ss.mkdel(this,function(){try{e:for(;;)switch(s){case 0:case 1:case 2:0===s&&(s=1);try{t:for(;;)switch(s){case 1:return s=-1,t=e.getMyCourseWorkStudentSubmission(this.$d,this.$e),s=2,void t.continueWith(n);case 2:return s=-1,void i.setResult(t.getAwaitedResult());default:break t}}catch(e){return void i.setResult(null)}s=-1;break e;default:break e}i.setResult(null)}catch(e){i.setException(ss.Exception.wrap(e))}});return n(),i.task},$5:function(e){var t,s,i=0,n=new ss.TaskCompletionSource,o=ss.mkdel(this,function(){try{e:for(;;)switch(i){case 0:case 1:case 2:0===i&&(i=1);try{t:for(;;)switch(i){case 1:return i=-1,t=e.listMyTeacherCourses(),i=2,void t.continueWith(o);case 2:return i=-1,s=t.getAwaitedResult(),void n.setResult(Enumerable.from(s).firstOrDefault(ss.mkdel(this,function(e){return ss.referenceEquals(e.id,this.$d)}),ss.getDefaultValue(VEL.Skynet.Global.Json.GoogleClassroom.Course)));default:break t}}catch(e){return void n.setResult(null)}i=-1;break e;default:break e}n.setResult(null)}catch(e){n.setException(ss.Exception.wrap(e))}});return o(),n.task},$9:function(e){var t,s,i,n=0,o=new ss.TaskCompletionSource,r=ss.mkdel(this,function(){try{e:for(;;)switch(n){case 0:return n=-1,e.get_userCanTurnInSubmission()&&!e.get_userHasTurnedInSubmission()?(t=this.$2(),n=1,void t.continueWith(r)):void o.setResult(null);case 1:return n=-1,s=t.getAwaitedResult(),i=s.turnInStudentSubmission(e.get_studentSubmission().courseId,e.get_studentSubmission().courseWorkId,e.get_studentSubmission().id),n=2,void i.continueWith(r);case 2:return n=-1,i.getAwaitedResult(),e.get_studentSubmission().state="TURNED_IN",void o.setResult(e.get_studentSubmission());default:break e}}catch(e){o.setException(ss.Exception.wrap(e))}});return r(),o.task},$2:function(){return ss.isNullOrUndefined(this.$a)&&(this.$a=VEL.Skynet.Global.Interop.GoogleClassroomClient.createDoAssignmentClient(this.$c,this.$b)),this.$a}}),ss.initClass(a,e,{getCurrentUserState:function(){return this.$2.$1()},signInToGoogleClassroom:function(){var e,t,s=0,i=new ss.TaskCompletionSource,n=ss.mkdel(this,function(){try{e:for(;;)switch(s){case 0:return s=-1,this.$0(),e=this.$2.$7(),s=1,void e.continueWith(n);case 1:return s=-1,e.getAwaitedResult(),t=this.loadUserAssignmentData(),s=2,void t.continueWith(n);case 2:s=-1,t.getAwaitedResult(),s=-1;break e;default:break e}i.setResult(null)}catch(e){i.setException(ss.Exception.wrap(e))}});return n(),i.task},forceSignInToGoogleClassroom:function(){var e,t,s=0,i=new ss.TaskCompletionSource,n=ss.mkdel(this,function(){try{e:for(;;)switch(s){case 0:return s=-1,this.$0(),e=this.$2.$0(),s=1,void e.continueWith(n);case 1:return s=-1,e.getAwaitedResult(),t=this.loadUserAssignmentData(),s=2,void t.continueWith(n);case 2:s=-1,t.getAwaitedResult(),s=-1;break e;default:break e}i.setResult(null)}catch(e){i.setException(ss.Exception.wrap(e))}});return n(),i.task},signOutFromGoogleClassroom:function(){return this.$0(),this.$2.$8()},$0:function(){this.$4=null},loadUserAssignmentData:function(){var e,t=0,s=new ss.TaskCompletionSource,i=ss.mkdel(this,function(){try{e:for(;;)switch(t){case 0:if(t=-1,ss.isNullOrUndefined(this.$4))return e=this.$2.$4(),t=1,void e.continueWith(i);t=-1;break e;case 1:t=-1,this.$4=e.getAwaitedResult(),t=-1;break e;default:break e}s.setResult(null)}catch(e){s.setException(ss.Exception.wrap(e))}});return i(),s.task},$1:function(){return this.$4||u.noUserAssignmentData},isUserAssignedToAssignment:function(){return this.$1().get_isAssignedToUser()},hasUserAlreadyCompletedAssignment:function(e){return!a.$0(e)&&this.$1().get_userHasTurnedInSubmission()},getStudentSubmissionState:function(){var e=new VEL.Skynet.Core.Application.GoogleClassroomStudentSubmissionState;return e.canTurnInSubmission=this.$1().get_userCanTurnInSubmission(),e.hasTurnedInSubmission=this.$1().get_userHasTurnedInSubmission(),e},get_homeworkSubmission:function(){return this.$1$1},set_homeworkSubmission:function(e){this.$1$1=e},onTurnInStudentSubmission:function(){var e,t,s,i,n=0,o=new ss.TaskCompletionSource,r=ss.mkdel(this,function(){try{e:for(;;)switch(n){case 0:n=-1,e="Error when turning-in Google Classroom assignment",n=1;continue e;case 1:case 2:case 3:1===n&&(n=2);try{t:for(;;)switch(n){case 2:return n=-1,t=this.turnInStudentSubmission(),n=3,void t.continueWith(r);case 3:n=-1,t.getAwaitedResult(),VEL.Skynet.Global.Modules.playPage.onTurnedInGoogleClassroomStudentSubmission(),n=-1;break t;default:break t}}catch(t){t=ss.Exception.wrap(t),ss.isInstanceOfType(t,ss.PromiseException)?(s=ss.cast(t,ss.PromiseException),a.$1.reportGoogleClassroomError(Strings.myActivities_DefaultError,e,s)):(i=t,a.$1.reportError$1(Strings.myActivities_DefaultError,e,i))}n=-1;break e;default:break e}o.setResult(null)}catch(e){o.setException(ss.Exception.wrap(e))}});return r(),o.task},turnInStudentSubmission:function(){var e,t,s,i=0,n=new ss.TaskCompletionSource,o=ss.mkdel(this,function(){try{e:for(;;)switch(i){case 0:if(i=-1,ss.isNullOrUndefined(this.get_homeworkSubmission()))throw new ss.InvalidOperationException("No homework submission has been recorded for the current user.");return e=this.$2.$9(this.$1()),i=1,void e.continueWith(o);case 1:if(i=-1,t=e.getAwaitedResult(),ss.isValue(t))return s=ss.Task.fromPromise(this.$3.setGoogleClassroomStudentSubmission(this.get_homeworkSubmission().HomeworkSubmissionId,t.courseId,t.courseWorkId,t.id),0),i=2,void s.continueWith(o);i=-1;break e;case 2:i=-1,s.getAwaitedResult(),i=-1;break e;default:break e}n.setResult(null)}catch(e){n.setException(ss.Exception.wrap(e))}});return o(),n.task}},null,[VEL.Skynet.Core.Application.IGoogleClassroomApplication,VEL.Skynet.Core.Application.IGoogleClassroomApplicationAssignment]),ss.initClass(u,e,{get_studentSubmission:function(){return this.$1$1},set_studentSubmission:function(e){this.$1$1=e},$1:function(){return ss.isValue(this.get_studentSubmission())},$0:function(){return ss.isValue(this.$2)},get_isAssignedToUser:function(){return this.$1()||this.$0()},get_userCanTurnInSubmission:function(){return this.$1()},get_userHasTurnedInSubmission:function(){return this.$1()&&"TURNED_IN"===this.get_studentSubmission().state}}),n.forcePseudo=!1,t.$0=".js-activity-wrapper",o.$3="test.doc",o.$2="test.config",o.$0="doc.value",o.$1=3145728,u.noUserAssignmentData=new u(null,null),a.$1=new VEL.Skynet.Global.Helpers.GoogleClassroomErrorReporter("https://skynetsites.github.io/perguntas-torta-na-cara/static/scripts/saltarelle/vel-skynet-application-client.js"),i.$1=!1}();
